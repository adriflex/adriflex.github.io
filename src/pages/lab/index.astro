---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('lab');
const sorted = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const toSlug = (id: string) => id.replace(/\.md$/, '');
---
<Base title="Lab" description="WIP, expériences, sketches, mises à jour — le carnet de bord d'Adrien Rouquié.">
  <section class="px-6 py-16 max-w-2xl mx-auto">

    <!-- En-tête -->
    <div class="mb-12">
      <div class="flex items-center gap-2 mb-4">
        <span class="w-8 h-px bg-accent"></span>
        <span class="text-sm font-body text-accent font-medium tracking-wide uppercase">Carnet de bord</span>
      </div>
      <h1 class="font-display text-5xl font-bold text-ink">Lab</h1>
      <p class="mt-3 font-body text-ink/60">WIP, expériences, sketches, updates. Pas de pression de finition ici.</p>
    </div>

    <!-- Liste -->
    {sorted.length === 0 ? (
      <p class="font-body text-ink/40 text-sm">Rien encore — revenez bientôt.</p>
    ) : (
      <ul>
        {sorted.map((post, i) => (
          <li class={i < sorted.length - 1 ? 'border-b border-ink/8' : ''}>
            <a
              href={`/lab/${toSlug(post.id)}`}
              class="flex justify-between items-start gap-4 py-5 group hover:text-accent transition-colors duration-200"
            >
              <div class="flex-1 min-w-0">
                <span class="font-body font-medium group-hover:underline underline-offset-4 decoration-accent block">
                  {post.data.title}
                </span>
                {post.data.tags.length > 0 && (
                  <div class="flex gap-1.5 mt-1.5 flex-wrap">
                    {post.data.tags.map(tag => (
                      <span class="text-xs text-ink/40 font-body">#{tag}</span>
                    ))}
                  </div>
                )}
              </div>
              <div class="flex items-center gap-4 shrink-0">
                {post.data.cover && (
                  <img
                    src={post.data.cover}
                    alt={post.data.title}
                    class="w-16 h-10 object-cover rounded-md opacity-80 group-hover:opacity-100 transition-opacity duration-200"
                  />
                )}
                <span class="text-sm font-body text-ink/40 mt-0.5 group-hover:text-accent transition-colors duration-200">
                  {new Date(post.data.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', year: 'numeric' })}
                </span>
              </div>
            </a>
          </li>
        ))}
      </ul>
    )}

  </section>
</Base>
